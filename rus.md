# Руководство по HTML5-видео для мобильных

![HTML5-видео для мобильных][Изображение]

За последние несколько лет поддержка HTML5-видео немного улучшилась, но, тем не 
менее, видео остаётся одним из тех компонентов HTML5, что поддерживаются 
браузерами очень по-разному, причём различия наиболее заметны на мобильных 
платформах. Ситуация осложняется ещё и тем, что на мобильных нельзя 
подстраховаться с помощью Flash, потому чрезвычайно важно убедиться что 
HTML5-видео работает. Это руководство поможет вам разобраться с реализацией 
HTML5-видео для мобильных платформ.

## Основы

### Видеокодировка 

В прошлом месяце Firefox добавила поддержку MP4 для мобильной платформы и все 
ведущие браузеры — Chrome, Safari, Firefox, IE, Opera (Mobile, не Mini) и 
Blackberry — сошлись на одном видео стандарте, что является отличной новостью, 
ведь теперь можно кодировать видео в одном формате: MP4 с кодеком H.264.

Однако, Firefox и Opera для настольных компьютеров пока не поддерживают 
MP4/H.264, так что вам, скорее всего, потребуется использовать дополнительный 
формат, например формат Ogg с кодеком Theora.

У H.264 есть некоторые ограничения лицензии, о которых вам следует знать, в 
отличии от Ogg и WebM, которые являются бесплатными и открытыми. 

Существует много программ для конвертации видео в нужный формат, в том числе 
приложений для настольных компьютеров и консольных утилит. Если вам нужно 
конвертировать видеофайлы, загруженные пользователями, вам могут пригодиться 
сервисы вроде [Zencoder][1] или [Amazon Elastic Encoder][2].

### Разметка

Теперь, когда ваше видео подготовлено, сделаем так чтобы оно проигрывалось. Тег 
`<video>` в HTML5 прост и незамысловат в использовании, это практически то же 
что добавить изображение!

    <video src="/videos/example.mp4" width="640" height="320" controls></video>

Если вы хотите добавить запасные форматы, поместите их в отдельные дочерние 
`<source>` внутри `<video>`.

    <video width="640" height="320" controls>
    <source src="/videos/example.mp4" type="video/mp4">
    <source src="/videos/example.ogv" type="video/ogg">
    <source src="="/videos/example.webm" type="video/webm">
    </video>
 
В браузере будет воспроизведён первый формат, который поддерживается.

## К размышлению

### Отзывчивый макет

Большое преимущество HTML5-видео состоит в том, что элементом `video` можно 
управлять как одним из блоков разметки. Например, если задать элементу `video` 
ширину 100% (и не указывать высоту), размеры этого блока будут автоматически 
подстраиваться под размеры родительского контейнера с сохранением пропорций, что 
прекрасно подходит для отзывчивых макетов. В то время как визуально изменить 
размеры видео легко, вам может понадобиться загрузка видео в меньшем размере для 
мобильных устройств, на которых подключение к сети медленнее и дороже. Можно 
произвести серверную проверку браузера и загрузить соответствующее видео или же 
динамически загружать исходный URL для видео в клиенте в JavaScript.

### Автопроигрывание

На мобильных платформах не поощряется использование атрибута `autoplay`, вместо 
этого для запуска проигрывания видео требуется действие пользователя, такое как 
клик по видео. Обоснованием этому служит то, что подключение к сети по тарифному 
плану для пользователей мобильных может быть дорогостоящим и загрузка больших 
видеофайлов, показ которых пользователь не запросил сам, недопустима. При 
крайней необходимости это ограничение можно обойти с помощью изобретательного 
кода JavaScript.

### Настраиваемые элементы управления

Ещё одно ключевое преимущество HTML5-видео — возможность создания собственных 
элементов управления, которые можно привязать к API и легко стилизировать с 
помощью CSS. Тем не менее, при разработке под мобильные устройства вы можете 
столкнуться с проблемами вроде отсутствия возможности перехода в полноэкранный 
режим с помощью элементов управления, или же перекрытие ваших элементов 
управления родными элементами управления плеера в полноэкранном режиме. 

## Решение проблем

Несколько распространённых причин по которых видео не проигрывается:

### Неправильный MIME-тип

Вам нужно убедиться, что, вне зависимости от источника, для вашего видео 
присваивается правильный MIME-тип, например, `video/mp4`, `video/ogg`, и т.д. 
Самый простой способ определить MIME-тип — с помощью команды `curl` в командной 
строке.

    curl -I http://mysite.com/videos/example.mp4

Если выведенное командой свойство `Content-Type` — не `video`, ваш веб-сервер 
нуждается в изменении настроек.

### Элементы управления не отображаются должным образом

Проверьте CSS на наличие слишком всеобъемлющих стилевых свойств, которые влияют 
на внешний вид исходных кнопок управления.

### iOS UIWebView

Чтобы обеспечить поддержку проигрывания HTML5-видео на текущей странице, что 
является действием по умолчанию в браузерах других ОС, нужно прописать свойство 
[`allowsInlineMediaPlayback`][3] и добавить атрибут `webkit-playsinline` для 
тега `video`, иначе видео будет проигрываться в медиа-плеере, используемом по 
умолчанию.

Также нужно установить значение `NO` для [`mediaPlaybackRequiresUserAction`][4] 
чтобы обеспечить поддержку автоматического проигрывания.

### Android WebView

Android WebView нуждается в определённых настройках чтобы поддерживать 
HTML5-видео. Активируйте ускорение аппаратной составляющей (укажите `android:hardwareAccelerated="true"` в файле AndroidManifest.xml) и настройте 
[WebChromeClient][5] в своём WebView.

Конечно, нужно учесть много чего при реализации HTML5-видео для мобильных, но 
постепенные улучшения в поддержке браузерами облегчают задачу предоставления 
вашим пользователям возможности бесперебойного просмотра видео в браузере.

[1]: http://zencoder.com/en/
[2]: http://aws.amazon.com/elastictranscoder/
[3]: https://developer.apple.com/library/ios/documentation/uikit/reference/UIWebView_Class/Reference/Reference.html
[4]: https://developer.apple.com/library/ios/documentation/uikit/reference/UIWebView_Class/Reference/Reference.html
[5]: http://developer.android.com/reference/android/webkit/WebChromeClient.html

[Изображение]: img/html5_video_primer-600x300.jpg